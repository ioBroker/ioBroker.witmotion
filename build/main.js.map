{"version":3,"file":"main.js","sourceRoot":"","sources":["../src/main.ts"],"names":[],"mappings":"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","sourcesContent":["import { type Socket, createSocket } from 'node:dgram';\nimport { SerialPort } from 'serialport';\nimport { Adapter, type AdapterOptions } from '@iobroker/adapter-core'; // Get common adapter utils\nimport type { WitMotionAdapterConfig } from './types';\n\ninterface Value {\n    value: number;\n    ts: number;\n    avg: { val: number; ts: number }[];\n}\n\nexport class WitMotionAdapter extends Adapter {\n    declare config: WitMotionAdapterConfig;\n    private serialPort?: SerialPort | null;\n    private reconnectTimer: ReturnType<typeof setInterval> | null = null;\n    private lastStates = new Map<string, Value>();\n    private tempBytes: number[] = [];\n    private isPortOpen = false;\n    private udpServer?: Socket;\n\n    public constructor(options: Partial<AdapterOptions> = {}) {\n        super({\n            ...options,\n            name: 'witmotion',\n            unload: async callback => {\n                if (this.reconnectTimer) {\n                    clearTimeout(this.reconnectTimer);\n                    this.reconnectTimer = null;\n                }\n                await this.closePort();\n                callback();\n            },\n            message: async obj => {\n                // read all serial ports and give them back to GUI\n                if (obj) {\n                    switch (obj.command) {\n                        case 'list':\n                            if (obj.callback) {\n                                try {\n                                    // read all found serial ports\n                                    const ports = await SerialPort.list();\n                                    this.log.info(`List of serialPort: ${JSON.stringify(ports)}`);\n                                    this.sendTo(\n                                        obj.from,\n                                        obj.command,\n                                        ports.map(item => ({\n                                            label: item.path,\n                                            value: item.path,\n                                        })),\n                                        obj.callback,\n                                    );\n                                } catch (e) {\n                                    this.log.error(`Cannot list ports: ${e}`);\n                                    this.sendTo(\n                                        obj.from,\n                                        obj.command,\n                                        [{ label: 'Not available', value: '' }],\n                                        obj.callback,\n                                    );\n                                }\n                            }\n\n                            break;\n\n                        case 'test':\n                            if (obj.callback) {\n                                try {\n                                    const result = await this.test(obj.message.serialPort, obj.message.baudRate);\n                                    this.sendTo(\n                                        obj.from,\n                                        obj.command,\n                                        {\n                                            result: result ? 'Sensor detected' : 'Sensor not detected',\n                                            error: !result ? 'Sensor not detected' : undefined,\n                                        },\n                                        obj.callback,\n                                    );\n                                } catch (e) {\n                                    this.sendTo(\n                                        obj.from,\n                                        obj.command,\n                                        { error: `Test failed: ${e.message || e}` },\n                                        obj.callback,\n                                    );\n                                }\n                            }\n                            break;\n                    }\n                }\n            },\n            ready: () => this.main(),\n        });\n    }\n\n    private async test(serialPort: string, baudRate: string | number): Promise<boolean> {\n        let portClosed = false;\n        if (this.config.serialPort === serialPort) {\n            portClosed = true;\n            await this.closePort();\n            if (this.reconnectTimer) {\n                clearInterval(this.reconnectTimer);\n                this.reconnectTimer = null;\n            }\n        }\n        const result = await this.testPort(serialPort, baudRate);\n        if (portClosed) {\n            this.retryOpenPort();\n        }\n        return result;\n    }\n\n    private async testPort(serialPort: string, baudRate: number | string): Promise<boolean> {\n        this.log.info(`Testing serialPort ${serialPort} with baud rate ${baudRate}`);\n        const testPort = new SerialPort({\n            path: serialPort,\n            baudRate: parseInt(baudRate as string, 10),\n            autoOpen: false,\n        });\n\n        await new Promise<void>((resolve, reject) => {\n            testPort.open(err => {\n                if (err) {\n                    this.log.error(\n                        `Failed to open serial serialPort ${serialPort} at ${baudRate}: ${err.message || err}`,\n                    );\n                    reject(err);\n                    return;\n                }\n                this.log.info(`Serial serialPort opened for testing: ${serialPort} @ ${baudRate}`);\n                resolve();\n            });\n        });\n\n        let receivedData = false;\n        const tempBytes: number[] = [];\n\n        // test data listener\n        testPort.on('data', (data: Buffer): void => {\n            const tempData: Buffer = Buffer.from(data);\n            for (const byte of tempData) {\n                console.log(`0x${byte.toString(16).padStart(2, '0')}`);\n                tempBytes.push(byte as unknown as number);\n                if (tempBytes.length === 2 && (tempBytes[0] !== 0x55 || tempBytes[1] !== 0x61)) {\n                    tempBytes.shift();\n                    continue;\n                }\n                if (tempBytes.length === 20) {\n                    receivedData = true;\n                }\n            }\n        });\n\n        // Wait up to 2 seconds for data\n        await new Promise<void>(resolve => setTimeout(() => resolve(), 2000));\n\n        await new Promise<void>(resolve => {\n            testPort.close(err => {\n                if (err) {\n                    this.log.error(`Error closing test serialPort: ${err.message || err}`);\n                }\n                this.log.info(`Test serial serialPort closed: ${serialPort} @ ${baudRate}`);\n                resolve();\n            });\n        });\n\n        if (receivedData) {\n            this.log.info(`Detected baud rate: ${baudRate}`);\n            return true;\n        }\n        return false;\n    }\n\n    private openUdpServer(port: number = 50547): void {\n        try {\n            const sock = createSocket('udp4');\n\n            sock.on('message', async (data: Buffer): Promise<void> => {\n                await this.setStateAsync('info.connection', true);\n                // Just push the data to handler\n                await this.process(data);\n            });\n\n            sock.on('error', (err: Error) => this.log.error(`UDP server error: ${err.message || err}`));\n\n            sock.on('listening', () => {\n                const address = sock.address();\n                this.log.debug(\n                    `UDP server listening on ${typeof address === 'string' ? address : `${address.address}:${address.port} for test purposes`}`,\n                );\n            });\n\n            sock.bind(port);\n            this.udpServer = sock;\n        } catch (e) {\n            this.log.error(`Failed to start UDP server: ${(e as Error).message || e}`);\n        }\n    }\n\n    private closeUdpServer(): Promise<void> {\n        if (!this.udpServer) {\n            return Promise.resolve();\n        }\n        return new Promise(resolve => {\n            try {\n                this.udpServer!.close(() => {\n                    this.log.info('UDP server closed');\n                    this.udpServer = undefined;\n                    resolve();\n                });\n            } catch (e) {\n                this.log.warn(`Error closing UDP server: ${(e as Error).message || e}`);\n                this.udpServer = undefined;\n                resolve();\n            }\n        });\n    }\n\n    private async openPort(): Promise<void> {\n        await this.closePort();\n\n        this.serialPort = new SerialPort({\n            path: this.config.serialPort,\n            baudRate: parseInt(this.config.baudRate as string, 10),\n        });\n\n        this.serialPort.on('open', () => {\n            this.tempBytes = [];\n            this.isPortOpen = true;\n            this.log.debug(`Serial port ${this.config.serialPort} opened`);\n            this.setState('info.connection', true, true).catch(err =>\n                this.log.error(`Cannot set info.connection state: ${err.message || err}`),\n            );\n        });\n\n        this.serialPort.on('data', async (data: Buffer): Promise<void> => this.process(data));\n\n        this.serialPort.on('error', err => {\n            this.tempBytes = [];\n            this.log.error(`Serial error: ${err.message}`);\n            if (this.isPortOpen) {\n                this.setState('info.connection', false, true).catch(err => {\n                    this.log.error(`Cannot set info.connection state: ${err.message || err}`);\n                });\n            }\n            this.isPortOpen = false;\n            this.retryOpenPort();\n        });\n\n        this.serialPort.on('close', () => {\n            if (this.isPortOpen) {\n                this.setState('info.connection', false, true).catch(err => {\n                    this.log.error(`Cannot set info.connection state: ${err.message || err}`);\n                });\n            }\n            this.tempBytes = [];\n            this.isPortOpen = false;\n            this.serialPort = null;\n            this.retryOpenPort();\n        });\n    }\n\n    async process(data: Buffer): Promise<void> {\n        const tempData: Buffer = Buffer.from(data);\n        for (const byte of tempData) {\n            this.tempBytes.push(byte as unknown as number);\n            if (this.tempBytes.length === 2 && (this.tempBytes[0] !== 0x55 || this.tempBytes[1] !== 0x61)) {\n                this.tempBytes.shift();\n                continue;\n            }\n            if (this.tempBytes.length === 20) {\n                const decodedData = WitMotionAdapter.processData(this.tempBytes.slice(2));\n                if (this.config.accelerometer) {\n                    await this.setStateIfChangedAsync(\n                        'acceleration.x',\n                        decodedData.acceleration.x,\n                        this.config.accelerometerUpdate as number,\n                        this.config.accelerometerAverageInterval as number,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'acceleration.y',\n                        decodedData.acceleration.y,\n                        this.config.accelerometerUpdate as number,\n                        this.config.accelerometerAverageInterval as number,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'acceleration.z',\n                        decodedData.acceleration.z,\n                        this.config.accelerometerUpdate as number,\n                        this.config.accelerometerAverageInterval as number,\n                    );\n                }\n                if (this.config.gyroscope) {\n                    await this.setStateIfChangedAsync(\n                        'gyroscope.x',\n                        decodedData.gyroscope.x,\n                        this.config.gyroscopeUpdate as number,\n                        this.config.gyroscopeAverageInterval as number,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'gyroscope.y',\n                        decodedData.gyroscope.y,\n                        this.config.gyroscopeUpdate as number,\n                        this.config.gyroscopeAverageInterval as number,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'gyroscope.z',\n                        decodedData.gyroscope.z,\n                        this.config.gyroscopeUpdate as number,\n                        this.config.gyroscopeAverageInterval as number,\n                    );\n                }\n                if (this.config.magnetometer) {\n                    await this.setStateIfChangedAsync(\n                        'angle.x',\n                        decodedData.angle.x,\n                        this.config.magnetometerUpdate as number,\n                        this.config.magnetometerAverageInterval as number,\n                        this.config.magnetometer360x,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'angle.y',\n                        decodedData.angle.y,\n                        this.config.magnetometerUpdate as number,\n                        this.config.magnetometerAverageInterval as number,\n                        this.config.magnetometer360y,\n                    );\n                    await this.setStateIfChangedAsync(\n                        'angle.z',\n                        decodedData.angle.z,\n                        this.config.magnetometerUpdate as number,\n                        this.config.magnetometerAverageInterval as number,\n                        this.config.magnetometer360z,\n                    );\n                }\n\n                this.tempBytes = [];\n            }\n        }\n    }\n\n    private closePort(): Promise<void> {\n        if (this.serialPort) {\n            return new Promise(resolve => {\n                try {\n                    if (this.serialPort!.isOpen) {\n                        this.serialPort!.close(err => {\n                            if (err) {\n                                this.log.error(`Error closing serial serialPort: ${err.message || err}`);\n                            }\n                            this.log.info('Serial serialPort closed');\n                            resolve();\n                        });\n                        return;\n                    }\n                } catch (e) {\n                    this.log.warn(`Error while closing serialPort: ${(e as Error).message || e}`);\n                }\n                this.serialPort = undefined;\n                resolve();\n            });\n        }\n\n        return Promise.resolve();\n    }\n\n    retryOpenPort(): void {\n        this.closePort().catch((err: Error) =>\n            this.log.error(`Error closing serial serialPort: ${err.message || err}`),\n        );\n\n        this.reconnectTimer ||= setInterval(() => {\n            if (!this.isPortOpen) {\n                this.openPort().catch(err => {\n                    this.log.warn(`Error reopening serial serialPort: ${err.message || err}`);\n                });\n            } else if (this.reconnectTimer) {\n                clearInterval(this.reconnectTimer);\n                this.reconnectTimer = null;\n            }\n        }, 3000); // Alle 3 Sekunde prüfen\n    }\n\n    private async setStateIfChangedAsync(\n        id: string,\n        value: number,\n        updateInterval: number,\n        averageInterval: number,\n        magnetometer360?: boolean,\n    ): Promise<void> {\n        const now = Date.now();\n        const prev = this.lastStates.get(id);\n        const changed = !prev || value !== prev.value;\n        if (!changed && prev && now - prev.ts < 60000) {\n            // unchanged and not older than 60s -> skip\n            return;\n        }\n        prev?.avg.push({ val: value, ts: now });\n\n        if (prev && now - prev.ts < updateInterval) {\n            // ignore too often update\n            return;\n        }\n        if (prev) {\n            // remove all values older than averageInterval\n            const ts = now - averageInterval;\n            for (let i = prev.avg.length - 1; i >= 0; i--) {\n                if (prev.avg[i].ts < ts) {\n                    // Delete all elements from i to 0\n                    prev.avg.splice(0, i + 1);\n                    break;\n                }\n            }\n            // Calculate average value\n            let avg = 0;\n            for (let i = prev.avg.length - 1; i >= 0; i--) {\n                avg += prev.avg[i].val;\n            }\n            avg /= prev.avg.length;\n            await this.setStateAsync(`${id}Avg`, magnetometer360 ? (avg < 0 ? avg + 360 : avg) : avg, true);\n        }\n\n        const newPrev: Value = prev || { value, ts: now, avg: [] };\n        newPrev.value = value;\n        newPrev.ts = now;\n\n        this.lastStates.set(id, newPrev);\n        await this.setStateAsync(id, magnetometer360 ? (value < 0 ? value + 360 : value) : value, true);\n    }\n\n    static processData(bytes: number[]): {\n        acceleration: { x: number; y: number; z: number };\n        gyroscope: { x: number; y: number; z: number };\n        angle: { x: number; y: number; z: number };\n    } {\n        const Ax = (WitMotionAdapter.getSignInt16((bytes[1] << 8) | bytes[0]) / 32768) * 16;\n        const Ay = (WitMotionAdapter.getSignInt16((bytes[3] << 8) | bytes[2]) / 32768) * 16;\n        const Az = (WitMotionAdapter.getSignInt16((bytes[5] << 8) | bytes[4]) / 32768) * 16;\n        const Gx = (WitMotionAdapter.getSignInt16((bytes[7] << 8) | bytes[6]) / 32768) * 2000;\n        const Gy = (WitMotionAdapter.getSignInt16((bytes[9] << 8) | bytes[8]) / 32768) * 2000;\n        const Gz = (WitMotionAdapter.getSignInt16((bytes[11] << 8) | bytes[10]) / 32768) * 2000;\n        const AngX = (WitMotionAdapter.getSignInt16((bytes[13] << 8) | bytes[12]) / 32768) * 180;\n        const AngY = (WitMotionAdapter.getSignInt16((bytes[15] << 8) | bytes[14]) / 32768) * 180;\n        const AngZ = (WitMotionAdapter.getSignInt16((bytes[17] << 8) | bytes[16]) / 32768) * 180;\n\n        return {\n            acceleration: { x: Ax, y: Ay, z: Az },\n            gyroscope: { x: Gx, y: Gy, z: Gz },\n            angle: { x: AngX, y: AngY, z: AngZ },\n        };\n    }\n\n    // Hilfsfunktion zur Umwandlung von 16-Bit-Werten\n    static getSignInt16(value: number): number {\n        return value > 0x7fff ? value - 0x10000 : value;\n    }\n\n    async syncAccelerationObjects(): Promise<void> {\n        const channel: ioBroker.ChannelObject = {\n            _id: 'acceleration',\n            type: 'channel',\n            common: {\n                name: 'Acceleration Data',\n            },\n            native: {},\n        };\n\n        const states: ioBroker.StateObject[] = [\n            {\n                _id: 'acceleration.x',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Acceleration X',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'acceleration.xAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average acceleration X',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'acceleration.y',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Acceleration Y',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'acceleration.yAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average acceleration Y',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'acceleration.z',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Acceleration Z',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'acceleration.zAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average acceleration Z',\n                    type: 'number',\n                    unit: 'g',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n        ];\n        if (this.config.accelerometer) {\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (!channelObj) {\n                await this.setObjectAsync(channel._id, channel);\n                for (const state of states) {\n                    await this.setObjectAsync(state._id, state);\n                }\n            }\n        } else {\n            // Remove objects\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (channelObj) {\n                await this.delObjectAsync(channel._id);\n                for (const state of states) {\n                    await this.delObjectAsync(state._id);\n                }\n            }\n        }\n    }\n\n    async syncGyroscopeObjects(): Promise<void> {\n        const channel: ioBroker.ChannelObject = {\n            _id: 'gyroscope',\n            type: 'channel',\n            common: {\n                name: 'Gyroscope Data',\n            },\n            native: {},\n        };\n\n        const states: ioBroker.StateObject[] = [\n            {\n                _id: 'gyroscope.x',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Gyroscope X',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'gyroscope.xAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average gyroscope X',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'gyroscope.y',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Gyroscope Y',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'gyroscope.yAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average gyroscope Y',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'gyroscope.z',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Gyroscope Z',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'gyroscope.zAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average gyroscope Z',\n                    type: 'number',\n                    unit: '°/s',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n        ];\n\n        if (this.config.gyroscope) {\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (!channelObj) {\n                await this.setObjectAsync(channel._id, channel);\n                for (const state of states) {\n                    await this.setObjectAsync(state._id, state);\n                }\n            }\n        } else {\n            // Remove objects\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (channelObj) {\n                await this.delObjectAsync(channel._id);\n                for (const state of states) {\n                    await this.delObjectAsync(state._id);\n                }\n            }\n        }\n    }\n\n    async syncAngleObjects(): Promise<void> {\n        const channel: ioBroker.ChannelObject = {\n            _id: 'angle',\n            type: 'channel',\n            common: {\n                name: 'Magnetometer Data',\n            },\n            native: {},\n        };\n\n        const states: ioBroker.StateObject[] = [\n            {\n                _id: 'angle.x',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Magnetometer X',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'angle.xAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Magnetometer angle X',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'angle.y',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Magnetometer Y',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'angle.yAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average angle Y',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'angle.z',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Magnetometer Z',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n            {\n                _id: 'angle.zAvg',\n                type: 'state',\n                common: {\n                    role: 'value',\n                    name: 'Average angle Z',\n                    type: 'number',\n                    unit: '°',\n                    read: true,\n                    write: false,\n                    def: 0,\n                },\n                native: {},\n            },\n        ];\n        if (this.config.magnetometer) {\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (!channelObj) {\n                await this.setObjectAsync(channel._id, channel);\n                for (const state of states) {\n                    await this.setObjectAsync(state._id, state);\n                }\n            }\n        } else {\n            // Remove objects\n            const channelObj = await this.getObjectAsync(channel._id);\n            if (channelObj) {\n                await this.delObjectAsync(channel._id);\n                for (const state of states) {\n                    await this.delObjectAsync(state._id);\n                }\n            }\n        }\n    }\n\n    async main(): Promise<void> {\n        await this.setStateAsync('info.connection', false, true);\n\n        if (this.config.test) {\n            // Open UDP port 50547 for test purposes\n            this.openUdpServer(50547);\n        }\n\n        if (!this.config.serialPort) {\n            return;\n        }\n\n        await this.syncAccelerationObjects();\n        await this.syncGyroscopeObjects();\n        await this.syncAngleObjects();\n\n        this.openPort().catch((err: Error) => this.log.error(`Error opening serial serialPort: ${err.message || err}`));\n    }\n}\n\nif (require.main !== module) {\n    // Export the constructor in compact mode\n    module.exports = (options: Partial<AdapterOptions> | undefined) => new WitMotionAdapter(options);\n} else {\n    // otherwise start the instance directly\n    (() => new WitMotionAdapter())();\n}\n"]}